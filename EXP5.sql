-- EXPERIMENT 5 - NESTED & CORRELATED QUERIES

-- NAME : MILAN GEORGE MATHEW
-- ROLL NO : 39
-- DATE : 13/08/2024

-- AIM
-- WRITE QUERIES TO CREATE AND RETRIEVE CUSTOMER AND PRODUCT RELATIONSHIP
----------------------------------------------------------------

----------------------------------------------------------------


-- CREATING TABLES


-- PRODUCT TABLE
CREATE TABLE PRODUCT (product_no VARCHAR(15) NOT NULL,description VARCHAR(20) NOT NULL,company VARCHAR(15) NOT NULL,price INT NOT NULL,PRIMARY KEY (product_no));

-- CUSTOMER TABLE
CREATE TABLE CUSTOMER (cust_no VARCHAR(15) NOT NULL,name VARCHAR(20) NOT NULL,age INT NOT NULL,city VARCHAR(30) NOT NULL,pincode INT NOT NULL,state VARCHAR(15) NOT NULL,PRIMARY KEY (cust_no));

-- SUPPLIER TABLE
CREATE TABLE SUPPLIER (s_no VARCHAR(10) NOT NULL,sname VARCHAR(20) NOT NULL,age INT NOT NULL,city VARCHAR(15) NOT NULL,PRIMARY KEY (s_no));

-- PURCHASE TABLE
CREATE TABLE PURCHASE (order_no VARCHAR(15) NOT NULL,custno VARCHAR(15) NOT NULL,prono VARCHAR(15) NOT NULL,quantity INT NOT NULL,orderdate DATE,PRIMARY KEY (order_no),FOREIGN KEY (custno) REFERENCES CUSTOMER(cust_no),FOREIGN KEY (prono) REFERENCES PRODUCT(product_no));


--INSERTING VALUES

--PRODUCT TABLE
INSERT INTO PRODUCT VALUES ('P00001', '12 W Flood Light', 'Wipro', 5000);
INSERT INTO PRODUCT VALUES('P00002', 'Laptop Adapter', 'Dell', 1560);
INSERT INTO PRODUCT VALUES('P00003', 'Tablet', 'HCL', 11000);
INSERT INTO PRODUCT VALUES('P00004', 'Garnet 50W led', 'Wipro', 999);
INSERT INTO PRODUCT VALUES('P00005', 'Laptop Charger', 'HCL', 1690);

-- CUSTOMER TABLE
INSERT INTO CUSTOMER VALUES ('C00001', 'Ivan Bayross', 35, 'Bombay', 400054, 'Maharashtra');
INSERT INTO CUSTOMER VALUES('C00002', 'Vandana Saitwal', 35, 'Madras', 780001, 'Tamilnadu');
INSERT INTO CUSTOMER VALUES('C00003', 'Pramada Jaguste', 55, 'Bombay', 400057, 'Maharashtra');
INSERT INTO CUSTOMER VALUES('C00004', 'Basu Navindgi', 45, 'Bombay', 400056, 'Maharashtra');
INSERT INTO CUSTOMER VALUES('C00005', 'Ravi Sreedharan', 25, 'Delhi', 100001, 'Delhi');
INSERT INTO CUSTOMER VALUES('C00006', 'Rukmini', 25, 'Madras', 780001, 'Tamilnadu');


-- SUPPLIER TABLE
INSERT INTO SUPPLIER VALUES ('S001', 'Ivan Bayross', 35, 'Bombay');
INSERT INTO SUPPLIER VALUES('S002', 'Nirmala Agarwal', 35, 'Madras');
INSERT INTO SUPPLIER VALUES('C003', 'Susmitha', 55, 'Bombay');
INSERT INTO SUPPLIER VALUES('C004', 'Basu Navindgi', 45, 'Bombay');    
INSERT INTO SUPPLIER VALUES('C005', 'Ravi Sreedharan', 25,'Delhi');
INSERT INTO SUPPLIER VALUES('C006', 'Nanda Gopal', 25, 'Madras'); 

-- PURCHASE TABLE
INSERT INTO PURCHASE VALUES ('O00001', 'C00002', 'P00003', 2, '20-JAN-16');
INSERT INTO PURCHASE VALUES('O00002', 'C00003', 'P00002', 1, '27-JAN-16');
INSERT INTO PURCHASE VALUES('O00003', 'C00004', 'P00002', 3, '28-JAN-16');
INSERT INTO PURCHASE VALUES('O00004', 'C00006', 'P00001', 3, '20-FEB-16');
INSERT INTO PURCHASE VALUES('O00005', 'C00003', 'P00005', 4, '07-APR-16');
INSERT INTO PURCHASE VALUES('O00006', 'C00004', 'P00002', 2, '22-MAY-16');
INSERT INTO PURCHASE VALUES('O00007', 'C00005', 'P00004', 1, '26-MAY-16');


-- -------------------------------
-- QUERIES
-- -------------------------------

-- -------------------------------
-- WRITE NESTED QUERIES FOR THE FOLLOWING 
-- -------------------------------


-- 1. LIST CUSTOMER- NUMBERS OF ALL WHO PURCHASED THE PRODUCT 'LAPTOP ADAPTER' DURING JANUARY 
SELECT CUSTNO FROM PURCHASE WHERE ORDERDATE LIKE '%-JAN-%' AND PRONO IN (SELECT PRONO FROM PURCHASE WHERE PRONO = 'P00002');

CUSTNO
---------------
C00004
C00003

-- 2. GET CUSTOMER NAMES  OF ALL WHO PURCHASED P00002
SELECT NAME FROM CUSTOMER WHERE CUST_NO IN (SELECT CUSTNO FROM PURCHASE WHERE PRONO = 'P00002');

NAME
--------------------
Pramada Jaguste
Basu Navindgi

-- 3. LIST CUSTOMER- NUMBERS OF ALL WHO HAVE PURCHASED PRODUCTS WITH COST MORE THAN RS 1600


-- 4. LIST CUSTOMER- NAMES OF ALL WHO HAVE PURCHASED PRODUCTS WITH COST MORE  THAN RS 1500 DURING JANUARY 

-- 5. LIST CUSTOMER- NUMBERS OF ALL WHO HAVE PURCHASED PRODUCTS WITH COST LESS THAN RS 1600  

-- 6. GET CUSTOMER NUMBERS  OF PURCHASES  SUCH THAT THE QTY IS MORE THAN MAXIMUM QTY OF ALL PURCHASES  OF C00002 

-- 7. GET THE NAME OF ALL THE CUSTOMERS WHO HAVE NOT PURCHASED ANY ITEM CURRENTLY 

-- 8. GET THE NAME OF ALL CUSTOMERS WHO HAVE PURCHASED AT LEAST ONE ITEM FROM WIPRO 


-- -------------------------------
-- WRITE CORRELATED QUERIES FOR THE FOLLOWING 
-- -------------------------------


-- 1. LIST ALL CUSTOMER- NUMBER PAIRS SUCH THAT COST OF THE ITEM PURCHASED BY THE FIRST CUSTOMER IS LESS THAN THAT OF SECOND CUSTOMER  

-- 2. LIST PAIRS OF CUSTOMER- NAMES OF ALL WHO HAS PURCHASED PRODUCTS WITH COST LESS THAN RS 1600  

-- 3. GET PRODUCT NOS OF ALL PRODUCTS PURCHASED BY MORE THAN ONE CUSTOMER 

-- 4. GET THE NAME OF CUSTOMERS WHO HAVE PURCHASED THE ITEM P00002 

-- 5. GET THE NAME OF CUSTOMERS WHO HAVE NOT PURCHASED THE ITEM P00002 

-- 6. GET THE NAME OF CUSTOMERS WHO HAVE PURCHASED AT LEAST ALL THOSE PRODUCTS PURCHASED BY C00004