-- EXPERIMENT 2 - CUSTOMER-PRODUCT-PURCHASE RELATIONS

-- NAME : MILAN GEORGE MATHEW
-- ROLL NO : 39
-- DATE : 23/07/2024

-- AIM
-- WRITE QUERIES TO CREATE AND RETRIEVE CUSTOMER AND PRODUCT RELATIONSHIP, CONSTRAINTS, BUILT IN FUNCTIONS, GROUP BY, ORDER BY, VIEW DROP, DML COMMAND.
----------------------------------------------------------------

----------------------------------------------------------------


-- CREATING TABLES


-- PRODUCT TABLE
CREATE TABLE PRODUCT (product_no VARCHAR(15) NOT NULL,description VARCHAR(20) NOT NULL,company VARCHAR(15) NOT NULL,price INT NOT NULL,PRIMARY KEY (product_no));

-- CUSTOMER TABLE
CREATE TABLE CUSTOMER (cust_no VARCHAR(15) NOT NULL,name VARCHAR(30) NOT NULL,age INT NOT NULL,city VARCHAR(30) NOT NULL,pincode INT NOT NULL,state VARCHAR(15) NOT NULL,PRIMARY KEY (cust_no));

-- SUPPLIER TABLE
CREATE TABLE SUPPLIER (s_no VARCHAR(10) NOT NULL,sname VARCHAR(30) NOT NULL,city VARCHAR(15) NOT NULL,PRIMARY KEY (s_no));

-- PURCHASE TABLE
CREATE TABLE PURCHASE (order_no VARCHAR(15) NOT NULL,custno VARCHAR(15) NOT NULL,prono VARCHAR(15) NOT NULL,quantity INT NOT NULL,orderdate DATE,PRIMARY KEY (order_no),FOREIGN KEY (custno) REFERENCES CUSTOMER(cust_no),FOREIGN KEY (prono) REFERENCES PRODUCT(product_no));


--INSERTING VALUES

--PRODUCT TABLE
INSERT INTO PRODUCT VALUES ('P00001', '12 W Flood Light', 'Wipro', 5000);
INSERT INTO PRODUCT VALUES('P00002', 'Laptop Adapter', 'Dell', 1560);
INSERT INTO PRODUCT VALUES('P00003', 'Tablet', 'HCL', 11000);
INSERT INTO PRODUCT VALUES('P00004', 'Garnet 50W led', 'Wipro', 999);
INSERT INTO PRODUCT VALUES('P00005', 'Laptop Charger', 'HCL', 1690);

-- CUSTOMER TABLE
INSERT INTO CUSTOMER VALUES ('C00001', 'Ivan Bayross', 35, 'Bombay', 400054, 'Maharashtra');
INSERT INTO CUSTOMER VALUES('C00002', 'Vandana Saitwal', 35, 'Madras', 780001, 'Tamilnadu');
INSERT INTO CUSTOMER VALUES('C00003', 'Pramada Jaguste', 55, 'Bombay', 400057, 'Maharashtra');
INSERT INTO CUSTOMER VALUES('C00004', 'Basu Navindgi', 45, 'Bombay', 400056, 'Maharashtra');
INSERT INTO CUSTOMER VALUES('C00005', 'Ravi Sreedharan', 25, 'Delhi', 100001, 'Delhi');
INSERT INTO CUSTOMER VALUES('C00006', 'Rukmini', 25, 'Madras', 780001, 'Tamilnadu');


-- SUPPLIER TABLE
INSERT INTO SUPPLIER VALUES ('S001', 'Ivan Bayross', 'Bombay');
INSERT INTO SUPPLIER VALUES('S002', 'Nirmala Agarwal', 'Madras');
INSERT INTO SUPPLIER VALUES('C003', 'Susmitha', 'Bombay');
INSERT INTO SUPPLIER VALUES('C004', 'Basu Navindgi', 'Bombay');    
INSERT INTO SUPPLIER VALUES('C005', 'Ravi Sreedharan', 'Delhi');
INSERT INTO SUPPLIER VALUES('C006', 'Nanda Gopal', 'Madras'); 

-- PURCHASE TABLE
INSERT INTO PURCHASE VALUES ('O00001', 'C00002', 'P00003', 2, '20-JAN-16');
INSERT INTO PURCHASE VALUES('O00002', 'C00003', 'P00002', 1, '27-JAN-16');
INSERT INTO PURCHASE VALUES('O00003', 'C00006', 'P00001', 3, '20-FEB-16');
INSERT INTO PURCHASE VALUES('O00004', 'C00003', 'P00005', 4, '07-APR-16');
INSERT INTO PURCHASE VALUES('O00005', 'C00004', 'P00002', 2, '22-MAY-16');
INSERT INTO PURCHASE VALUES('O00006', 'C00005', 'P00004', 1, '26-MAY-16');


-- -------------------------------
-- QUERIES
-- -------------------------------

-- 1. LIST ALL CUSTOMERS IN MADRAS
SELECT NAME 
FROM CUSTOMER 
WHERE CITY='Madras';

NAME
------------------------------
Vandana Saitwal
Rukmini

-- 2. LIST ALL CUSTOMER- NUMBERS OF ALL WHO PURCHASE THE PRODUCT IN THE MONTH OF JANUARY
SELECT CUSTNO 
FROM PURCHASE 
WHERE ORDERDATE 
LIKE '%-JAN-%';

CUSTNO
---------------
C00002
C00003

-- 3. LIST ALL THE NAME OF COMPANY WHOSE PRICE IS GREATER THAN 5000 
SELECT COMPANY 
FROM PRODUCT 
WHERE PRICE > 5000;

COMPANY
---------------
HCL

-- 4. LIST ALL THE CUSTOMERS WHOSE NAME IS NOT BEGINNING WITH ‘R’
SELECT NAME 
FROM CUSTOMER 
WHERE NAME NOT LIKE 'R%';

NAME
------------------------------
Ivan Bayross
Vandana Saitwal
Pramada Jaguste
Basu Navindgi

-- 5. ADD EMAIL FIELD INTO THE CUSTOMER TABLE
ALTER TABLE CUSTOMER 
ADD EMAIL_ID VARCHAR(20);

Table altered.

-- 6. LIST ALL THE CUSTOMERS WHOSE AGE IS GREATER THAN 40 IN MAHARASHTRA
SELECT NAME 
FROM CUSTOMER 
WHERE AGE>40;

NAME
------------------------------
Pramada Jaguste
Basu Navindgi

-- 7. DISPLAY THE COMPANY’S NAME IN THE INCREASING ORDER OF PRICE
SELECT COMPANY 
FROM PRODUCT 
ORDER BY PRICE;

COMPANY
---------------
Wipro
Dell
HCL
Wipro
HCL

-- 8. CALCULATE AVERAGE AGE OF CUSTOMERS FROM TABLE CUSTOMER. 
SELECT AVG(AGE) 
FROM CUSTOMER;

  AVG(AGE)
----------
36.6666667

-- 9. LIST CITIES OF CUSTOMERS FROM STATES MAHARASHTRA & TAMIL NADU
SELECT CITY 
FROM CUSTOMER 
WHERE STATE = 'Maharashtra' 
OR STATE = 'Tamilnadu';

CITY
------------------------------
Bombay
Madras
Bombay
Bombay
Madras

-- 10. FIND AVERAGE PRICE FROM TABLE PRODUCT. 
SELECT AVG(PRICE) 
FROM PRODUCT;

AVG(PRICE)
----------
    4049.8

-- 11. LIST ALL CUSTOMER NOS IN THE INCREASING ORDER OF QUANTITY FROM TABLE PURCHASE
SELECT CUSTNO 
FROM PURCHASE 
ORDER BY QUANTITY;

CUSTNO
---------------
C00002
C00003
C00003
C00004
C00005
C00006

6 rows selected.

-- 12. UPDATE PRODUCT NUMBER OF CUSTOMER NUMBER C00003 TO P00008
INSERT INTO PRODUCT VALUES('P00008','Mouse','Artic Fox','700');

1 row created.

UPDATE PURCHASE SET PRONO = 'P00008' WHERE CUSTNO = 'C00003';

2 rows updated.

-- 13. FIND THE NUMBER OF CUSTOMERS FROM CITY DELHI. 
SELECT COUNT(CITY) 
FROM CUSTOMER 
WHERE CITY='Delhi';

COUNT(CITY)
-----------
          1

-- 14. LIST CUSTOMER NUMBER OF ALL CUSTOMERS WHO HAVE PURCHASED MORE THAN 3 ITEMS
SELECT CUSTNO 
FROM PURCHASE 
WHERE QUANTITY>3;

CUSTNO
---------------
C00003

-- 15. MODIFY THE STRUCTURE OF ORDER DATE FIELD IN THE PURCHASE INTO CHARACTER. 
UPDATE PURCHASE SET ORDERDATE = NULL;

6 rows updated.

ALTER TABLE PURCHASE 
MODIFY ORDERDATE VARCHAR(10);

Table altered.

-- 16. FIND MIN AND MAX PRICE FROM PRODUCT TABLE. 
SELECT MIN(PRICE),MAX(PRICE) 
FROM PRODUCT;

MIN(PRICE) MAX(PRICE)
---------- ----------
       700      11000

-- 17. FIND NUMBER OF PRODUCTS BY WIPRO AND HCL SEPARATELY. 
SELECT COMPANY,COUNT(*) 
FROM PRODUCT 
WHERE COMPANY = 'Wipro' 
OR COMPANY ='HCL' 
GROUP BY COMPANY;

COMPANY           COUNT(*)
--------------- ----------
Wipro                    2
HCL                      2

-- 18. LIST ALL CUSTOMERS IN ALPHABETICAL ORDER. 
SELECT NAME 
FROM CUSTOMER 
ORDER BY NAME;

NAME
------------------------------
Basu Navindgi
Ivan Bayross
Pramada Jaguste
Ravi Sreedharan
Rukmini
Vandana Saitwal

6 rows selected.

-- 19. SORT CONTENTS OF PURCHASE TABLE IN DESCENDING ORDER OF DATE
ALTER TABLE PURCHASE 
MODIFY ORDERDATE DATE;

Table altered.

UPDATE PURCHASE SET ORDERDATE = '20-JAN-16' WHERE ORDER_NO = 'O00001';

1 row updated.

UPDATE PURCHASE SET ORDERDATE = '27-JAN-16' WHERE ORDER_NO = 'O00002';

1 row updated.

UPDATE PURCHASE SET ORDERDATE = '20-FEB-16' WHERE ORDER_NO = 'O00003';

1 row updated.

UPDATE PURCHASE SET ORDERDATE = '07-APR-16' WHERE ORDER_NO = 'O00004';

1 row updated.

UPDATE PURCHASE SET ORDERDATE = '22-MAY-16' WHERE ORDER_NO = 'O00005';

1 row updated.

UPDATE PURCHASE SET ORDERDATE = '26-MAY-16' WHERE ORDER_NO = 'O00006';

1 row updated.

SELECT * 
FROM PURCHASE 
ORDER BY ORDERDATE DESC;

ORDER_NO        CUSTNO          PRONO             QUANTITY ORDERDATE
--------------- --------------- --------------- ---------- ------------------
O00006          C00005          P00004                   1 26-MAY-16
O00005          C00004          P00002                   2 22-MAY-16
O00004          C00003          P00008                   4 07-APR-16
O00003          C00006          P00001                   3 20-FEB-16
O00002          C00003          P00008                   1 27-JAN-16
O00001          C00002          P00003                   2 20-JAN-16

6 rows selected.

-- 20. DELETE THE PRODUCT WITH PRODUCT_NO = P00003 
ALTER TABLE PURCHASE 
MODIFY PRONO VARCHAR(15) NULL;

Table altered.

UPDATE PURCHASE SET PRONO=NULL WHERE PRONO='P00003';

1 row updated.

DELETE FROM PRODUCT 
WHERE PRODUCT_NO='P00003';

1 row deleted.

-- 21. COPY THE CONTENTS OF FIELD ORDER_NO AND ORDERDATE OF PURCHASE TABLE INTO NEW TABLE. 
CREATE TABLE ORDERS AS 
SELECT ORDER_NO,ORDERDATE 
FROM PURCHASE;

Table created.

-- 22. DELETE THE NEWLY CREATED TABLE. 
DROP TABLE ORDERS;

Table dropped.

-- 23. CREATE VIEW OF CUSTOMER TABLE. 
CREATE VIEW CUST_VIEW AS 
SELECT * 
FROM CUSTOMER;

View created.

-- 24. LIST NAMES OF CUSTOMERS WHO HAVE PLACED MORE THAN ONE ORDER.
SELECT C.NAME FROM CUSTOMER C 
INNER JOIN PURCHASE P ON C.CUST_NO = P.CUSTNO 
GROUP BY C.CUST_NO, C.NAME 
HAVING COUNT(*) > 1;

NAME
------------------------------
Pramada Jaguste


-- 25. RETRIEVE TRANSACTION DETAILS OF CUSTOMER WHO LIVES IN SAME CITY, OBTAIN THE RESULT THROUGH SELF -JOIN AND CORRELATED JOIN.
SELECT C1.NAME AS CUSTOMER1, C2.NAME AS CUSTOMER2, P.ORDER_NO, P.ORDERDATE 
FROM CUSTOMER C1 
INNER JOIN CUSTOMER C2 ON C1.CITY = C2.CITY 
AND C1.CUST_NO <> C2.CUST_NO 
INNER JOIN PURCHASE P ON C1.CUST_NO = P.CUSTNO 
ORDER BY C1.NAME, C2.NAME;

CUSTOMER1                      CUSTOMER2                      ORDER_NO
------------------------------ ------------------------------ ---------------
ORDERDATE
---------
Basu Navindgi                  Ivan Bayross                   O00005
22-MAY-16

Basu Navindgi                  Pramada Jaguste           
     O00005
22-MAY-16
     O00004
07-APR-16


CUSTOMER1                      CUSTOMER2                      ORDER_NO
------------------------------ ------------------------------ ---------------
ORDERDATE
---------
Pramada Jaguste                Basu Navindgi                  O00002
27-JAN-16

Pramada Jaguste                Ivan Bayross                   O00002
27-JAN-16

Pramada Jaguste                Ivan Bayross                   O00004
07-APR-16


CUSTOMER1                      CUSTOMER2                      ORDER_NO
------------------------------ ------------------------------ ---------------
ORDERDATE
---------
Rukmini                        Vandana Saitwal                O00003
20-FEB-16

Vandana Saitwal                Rukmini                        O00001
20-JAN-16


8 rows selected.

--26. RETRIEVE CUSTOMER NAMES STARTING WITH ‘R’.
SELECT NAME 
FROM CUSTOMER 
WHERE NAME LIKE 'R%';  

NAME
------------------------------
Ravi Sreedharan
Rukmini

--27. LIST NAMES OF PERSONS WHO ARE EITHER A SUPPLIER OR A CUSTOMER
SELECT NAME 
FROM CUSTOMER 
UNION 
SELECT SNAME 
FROM SUPPLIER;

NAME
------------------------------
Ivan Bayross
Vandana Saitwal
Pramada Jaguste
Basu Navindgi
Ravi Sreedharan
Rukmini
Nirmala Agarwal
Susmitha
Nanda Gopal

9 rows selected.
